From 28fdc49b50760e9655f675aac48212582290776d Mon Sep 17 00:00:00 2001
From: Eneas U de Queiroz <cotequeiroz@gmail.com>
Date: Thu, 29 Sep 2022 17:34:31 -0300
Subject: [PATCH 4/4] fixup! libopkg: pkg_hash: consider names stripped of ABI

---
 libopkg/pkg_hash.c | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/libopkg/pkg_hash.c b/libopkg/pkg_hash.c
index 681e7c8..9494211 100644
--- a/libopkg/pkg_hash.c
+++ b/libopkg/pkg_hash.c
@@ -417,6 +417,7 @@ pkg_t *pkg_hash_fetch_best_installation_candidate(abstract_pkg_t * apkg,
 			char *stripped_name = NULL;
 			const char *abiver;
 			size_t abilen, namelen;
+			int cli_score;
 
 			/* It has been provided by hand, so it is what user want */
 			if (matching->provided_by_hand == 1) {
@@ -437,16 +438,16 @@ pkg_t *pkg_hash_fetch_best_installation_candidate(abstract_pkg_t * apkg,
 			if (strcmp(matching->name, apkg->name) == 0)
 				score++;
 
-			for (j = 0; j < opkg_cli_argc; ++j) {
+			for (j = 0, cli_score = 0; j < opkg_cli_argc; ++j) {
 				if (!strcmp(matching->name, opkg_cli_argv[j])) {
-					score += 4;
+					cli_score = 4;
 					break;
 				} else if (stripped_name &&
 					   !strcmp(stripped_name, opkg_cli_argv[j])) {
-					score += 2;
-					break;
+					cli_score = 2;
 				}
 			}
+			score += cli_score;
 			free(stripped_name);
 
 			opkg_msg(DEBUG, "Candidate: %s %s (score %d).\n",
-- 
2.35.1

