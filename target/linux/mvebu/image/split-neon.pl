#!/usr/bin/perl
-e "cortexa9.mk.orig" and die "Error: cortexa9.mk.orig already exists";
-e "cortexa9neon.mk" and die "Error: cortexa9neon.mk already exists";
$signature = "### automatically generated by split-neon.pl from upstream cortexa9.mk.";
$/='';
open FILE, "<cortexa9.mk" or die $!;
while (<FILE>) {
    /$signature/ and die "cortexa9.mk has already been split";
}
close FILE;
rename("cortexa9.mk","cortexa9.mk.orig") or die "rename cortexa9.mk to cortexa9.mk.orig: $!";
open FILE, "<cortexa9.mk.orig" or die $!;
open VFP, ">cortexa9.mk" or die $!;
open NEON, ">cortexa9neon.mk" or die $!;
while (<FILE>) {
    print NEON $_ unless /TARGET_DEVICES/ && !/armada-38[58]/;
    print VFP $_ unless /TARGET_DEVICES/ && /armada-38[58]/;
}
print NEON "$signature\n";
print VFP "$signature\n";
close FILE;
close NEON;
close VFP;
unlink "cortexa9.mk.orig" or die "Can't remove cortexa9.mk.orig: $!";
